# ===================================================================
#   Machine configuration
# ===================================================================
MACHINE ?= "raspberrypi4-64"

# ===================================================================
#   Downloads and sstate cache directories
# ===================================================================
DL_DIR ?= "/home/isaac/poky/downloads"
SSTATE_DIR ?= "/home/isaac/poky/sstate-cache"
UNINATIVE_DLDIR ?= "${DL_DIR}/uninative"
DISTRO ?= "poky"

# ===================================================================
#   Build optimization
# ===================================================================
INHERIT += "rm_work"

# ===================================================================
#   Packages to include in the image
# ===================================================================
IMAGE_INSTALL:append = " \
    python3 \
    python3-requests python3-pyserial python3-smbus2 python3-gpiod \
    python3-flask \
    iw \
    wpa-supplicant wpa-supplicant-cli \
    linux-firmware \
    dhcpcd net-tools ethtool \
    openssh \
    nano \
    connect-wifi \
    python3-picamera2  \
    libcamera libcamera-apps \
    python3-libcamera \
    python3-numpy opencv \
    ffmpeg \           
"


# ===================================================================
#   Image features
# ===================================================================
IMAGE_FEATURES += " ssh-server-openssh "
EXTRA_IMAGE_FEATURES += " debug-tweaks "


# ===================================================================
#   Rootfs sizing
# ===================================================================
IMAGE_ROOTFS_SIZE ?= "2200000"
IMAGE_OVERHEAD_FACTOR = "1.0"
IMAGE_ROOTFS_EXTRA_SPACE = "524288"

# ===================================================================
#   Licenses (para Wi-Fi firmware)
# ===================================================================
LICENSE_FLAGS_ACCEPTED += "synaptics-killswitch commercial"

# ===================================================================
#   Raspberry Pi specific configs
# ===================================================================
# Añade entradas extra a config.txt en la partición de boot
# (aquí activamos el overlay de la cámara IMX219; cambiar por imx477 si es HQ Camera)
RPI_EXTRA_CONFIG += "dtoverlay=imx219"

# Fuerza a ignorar la receta antigua de meta-raspberrypi (libcamera-apps)
BBMASK .= "|.*/meta-raspberrypi/dynamic-layers/multimedia-layer/recipes-multimedia/libcamera-apps/.*"


# ===================================================================
#   Version control
# ===================================================================
CONF_VERSION = "2"

BB_NUMBER_THREADS = "8"

INHERIT:remove = "spdx"
